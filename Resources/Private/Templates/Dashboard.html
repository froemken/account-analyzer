<f:layout name="Default" />

<f:section name="Main">
    <!-- Global Summary -->
    <div class="card mb-4">
        <div class="card-body text-center">
            <div class="row">
                <div class="col-md-4">
                    <h5 class="text-success">Einnahmen</h5>
                    <p class="fs-4 fw-bold">{report.total.income -> f:format.number(decimals: 2, decimalSeparator: ',',
                        thousandsSeparator: '.')} €</p>
                </div>
                <div class="col-md-4">
                    <h5 class="text-danger">Ausgaben</h5>
                    <p class="fs-4 fw-bold">{report.total.expense -> f:format.number(decimals: 2, decimalSeparator: ',',
                        thousandsSeparator: '.')} €</p>
                </div>
                <div class="col-md-4">
                    <h5 class="text-primary">Differenz</h5>
                    <p class="fs-4 fw-bold">{report.total.diff -> f:format.number(decimals: 2, decimalSeparator: ',',
                        thousandsSeparator: '.')} €</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Toggles -->
    <div class="d-flex justify-content-center mb-4">
        <div class="btn-group">
            <button class="btn btn-outline-primary active" id="btn-month" onclick="showView('month')">Monatsansicht</button>
            <button class="btn btn-outline-primary" id="btn-year" onclick="showView('year')">Jahresansicht</button>
        </div>
    </div>

    <!-- Month View -->
    <div id="view-month">
        <ul class="nav nav-tabs mb-3" id="monthTabs" role="tablist">
            <f:for each="{report.months}" as="month">
                <li class="nav-item" role="presentation">
                    <button class="nav-link {f:if(condition: '{month.number} == 1', then: 'active')}"
                            id="tab-{month.number}"
                            data-bs-toggle="tab"
                            data-bs-target="#content-{month.number}"
                            type="button"
                            role="tab">
                        {month.name}
                    </button>
                </li>
            </f:for>
        </ul>
        <div class="tab-content">
            <f:for each="{report.months}" as="month">
                <div class="tab-pane fade {f:if(condition: '{month.number} == 1', then: 'show active')}"
                    id="content-{month.number}" role="tabpanel">
                    <div class="alert alert-light border mb-3 text-center">
                        <span class="me-3">Ein: <span class="text-success">{month.income -> f:format.number(decimals: 2, decimalSeparator: ',', thousandsSeparator: '.')} €</span></span>
                        <span class="me-3">Aus: <span class="text-danger">{month.expense -> f:format.number(decimals: 2, decimalSeparator: ',', thousandsSeparator: '.')} €</span></span>
                        <span>Diff: <strong>{month.diff -> f:format.number(decimals: 2, decimalSeparator: ',', thousandsSeparator: '.')} €</strong></span>
                    </div>
                    <table class="table table-striped table-sm">
                        <thead>
                            <tr>
                                <th>Datum</th>
                                <th>Empfänger</th>
                                <th>Zweck</th>
                                <th class="text-end">Betrag</th>
                            </tr>
                        </thead>
                        <tbody>
                            <f:for each="{month.transactions}" as="transaction">
                                <tr>
                                    <td>{transaction.formattedDate}</td>
                                    <td>{transaction.recipient}</td>
                                    <td>{transaction.description}</td>
                                    <td class="text-end {f:if(condition: '{t.amount} >= 0', then: 'text-success', else: 'text-danger')}">
                                        {transaction.amount -> f:format.number(decimals: 2, decimalSeparator: ',', thousandsSeparator: '.')} €
                                    </td>
                                </tr>
                            </f:for>
                        </tbody>
                    </table>
                </div>
            </f:for>
        </div>
    </div>

    <!-- Year View -->
    <div id="view-year" style="display:none;">
        <ul class="list-group">
            <f:for each="{report.months}" as="month">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span class="fw-bold" style="width: 100px;">{month.name}</span>
                    <div class="flex-grow-1 text-end">
                        <span class="text-success me-3">{month.income -> f:format.number(decimals: 2, decimalSeparator:
                            ',', thousandsSeparator: '.')} €</span>
                        <span class="text-danger me-3">{month.expense -> f:format.number(decimals: 2, decimalSeparator:
                            ',', thousandsSeparator: '.')} €</span>
                        <strong
                            class="{f:if(condition: '{month.diff} >= 0', then: 'text-success', else: 'text-danger')}">
                            {month.diff -> f:format.number(decimals: 2, decimalSeparator: ',', thousandsSeparator: '.')}
                            €
                        </strong>
                    </div>
                </li>
            </f:for>
        </ul>
    </div>
</f:section>

<f:section name="Scripts">
    <script>
        function showView(view) {
            document.getElementById('view-month').style.display = view === 'month' ? 'block' : 'none';
            document.getElementById('view-year').style.display = view === 'year' ? 'block' : 'none';
            document.getElementById('btn-month').classList.toggle('active', view === 'month');
            document.getElementById('btn-year').classList.toggle('active', view === 'year');
        }
    </script>
</f:section>